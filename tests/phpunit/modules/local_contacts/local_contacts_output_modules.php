<?php

use PHPUnit\Framework\TestCase;

class Hm_Test_Local_Contacts_Output_Modules extends TestCase {
    public function setUp(): void {
        require __DIR__.'/../../helpers.php';
        require APP_PATH.'modules/local_contacts/modules.php';
    }

    /**
     * @preserveGlobalState disabled
     * @runInSeparateProcess
     */
    public function test_contacts_form() {
        $test = new Output_Test('contacts_form', 'local_contacts');
        $res = $test->run();
        $this->assertEquals(array('<div class="modal fade" id="localContactModal" tabindex="-1" aria-labelledby="localContactModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content custom-modal-content"><div class="modal-header custom-modal-header"><h5 class="modal-title d-flex align-items-center" id="localContactModalLabel"><div class="modal-icon-wrapper me-2"><i class="bi bi-person-plus" style="font-size: 24px;"></i></div>Add Local Contact</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body custom-modal-body"><div class="contact-method-toggle"><button type="button" class="method-btn active" id="manual-entry-btn"><i class="bi bi-person-plus" style="width: 18px; height: 18px;"></i><span>Manual Entry</span></button><button type="button" class="method-btn" id="csv-import-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><line x1="9" y1="15" x2="15" y2="15"/></svg><span>Import CSV</span></button></div><form class="contact-manual-form" id="manual-contact-form" method="POST"><input type="hidden" name="contact_source" value="local" /><input type="hidden" name="hm_page_key" value="" /><div class="row"><div class="col-md-6 mb-3"><label for="contact_name" class="form-label">Display Name <span class="text-danger">*</span></label><input type="text" class="form-control custom-input" id="contact_name" name="contact_name" placeholder="John Doe" value="" required></div><div class="col-md-6 mb-3"><label for="contact_email" class="form-label">Email Address <span class="text-danger">*</span></label><input type="email" class="form-control custom-input" id="contact_email" name="contact_email" placeholder="john.doe@example.com" value="" required></div></div><div class="mb-3"><label for="contact_phone" class="form-label">Phone Number</label><input type="tel" class="form-control custom-input" id="contact_phone" name="contact_phone" placeholder="+1 234 567 8900" value=""></div><div class="mb-3"><label for="contact_group" class="form-label">Category</label><select class="form-select custom-input" id="contact_group" name="contact_group"><option value="Collected Recipients">Collected Recipients</option><option value="Trusted Senders">Trusted Senders</option><option value="Personal Addresses" selected>Personal Addresses</option></select></div></form><div class="csv-import-section" style="display: none;"><form id="csv-import-form" method="POST" enctype="multipart/form-data"><input type="hidden" name="contact_source" value="csv" /><input type="hidden" name="hm_page_key" value="" /><div class="csv-info-card"><div class="csv-info-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></div><div><h6 class="csv-info-title">CSV Format Requirements</h6><p class="csv-info-text">Your CSV file must include headers: <strong>display_name</strong>, <strong>email_address</strong>, <strong>phone_number</strong></p><a href="modules/local_contacts/assets/data/contact_sample.csv" class="csv-download-link" download data-external="true">Download sample CSV file</a></div></div><div class="csv-upload-area"><input type="file" id="contact_csv" name="contact_csv" accept=".csv" class="csv-file-input" required><label for="contact_csv" class="csv-upload-label"><div class="csv-upload-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></div><p class="csv-upload-text"><strong>Click to upload</strong> or drag and drop</p><p class="csv-upload-hint">CSV files only</p></label></div></form></div></div><div class="modal-footer custom-modal-footer"><button type="button" class="btn btn-secondary custom-btn-secondary" data-bs-dismiss="modal">Cancel</button><button type="submit" class="btn btn-primary custom-btn-primary" id="submit-local-contact-btn">Add Contact</button></div></div></div></div>'), $res->output_response);
    }
}